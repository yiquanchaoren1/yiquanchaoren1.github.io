

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="hzbing">
  <meta name="keywords" content="">
  
    <meta name="description" content="测试halo &#x3D; 2 验证结果 ，边界上的值不用验证，验证通过。 但是边界上的值计算了吗？边界上的值不用计算，再看看demo，设置合理范围。 2025年4月5日20:48:29 halo区不统一，核函数中对不同数组计算下标的时候怎么办？ 将HLAO统一设置为2 ，所有的三维以上数组设置2的halo区，以便统一下标计算方式。 halo &#x3D; 1 的数组设置为halo &#x3D;">
<meta property="og:type" content="article">
<meta property="og:title" content="单卡到多卡success!!!">
<meta property="og:url" content="http://example.com/2025/05/17/suc/index.html">
<meta property="og:site_name" content="一拳超人">
<meta property="og:description" content="测试halo &#x3D; 2 验证结果 ，边界上的值不用验证，验证通过。 但是边界上的值计算了吗？边界上的值不用计算，再看看demo，设置合理范围。 2025年4月5日20:48:29 halo区不统一，核函数中对不同数组计算下标的时候怎么办？ 将HLAO统一设置为2 ，所有的三维以上数组设置2的halo区，以便统一下标计算方式。 halo &#x3D; 1 的数组设置为halo &#x3D;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/1743939194177.png">
<meta property="og:image" content="http://example.com/images/1744271955209.png">
<meta property="og:image" content="http://example.com/images/1744275765343.png">
<meta property="og:image" content="http://example.com/images/1744285669542.png">
<meta property="og:image" content="http://example.com/images/1744339496709.png">
<meta property="og:image" content="http://example.com/images/1744373137255.png">
<meta property="og:image" content="http://example.com/images/1744532889327.png">
<meta property="og:image" content="http://example.com/images/1744532952060.png">
<meta property="og:image" content="http://example.com/images/1744620939997.png">
<meta property="og:image" content="http://example.com/images/1745034913911.png">
<meta property="og:image" content="http://example.com/images/1745038132088.png">
<meta property="og:image" content="http://example.com/images/1745041416805.png">
<meta property="og:image" content="http://example.com/images/1745041399822.png">
<meta property="og:image" content="http://example.com/images/1745045485235.png">
<meta property="og:image" content="http://example.com/images/1745046145504.png">
<meta property="og:image" content="http://example.com/images/1745050315934.png">
<meta property="og:image" content="http://example.com/images/1745063419053.png">
<meta property="og:image" content="http://example.com/images/1745063432190.png">
<meta property="og:image" content="http://example.com/images/1745063786691.png">
<meta property="og:image" content="http://example.com/images/1745110453352.png">
<meta property="og:image" content="http://example.com/images/1745322298083.png">
<meta property="og:image" content="http://example.com/images/1745322348260.png">
<meta property="og:image" content="http://example.com/images/1745322547279.png">
<meta property="og:image" content="http://example.com/images/1745322916856.png">
<meta property="og:image" content="http://example.com/images/1745322980331.png">
<meta property="og:image" content="http://example.com/images/1745323027495.png">
<meta property="og:image" content="http://example.com/images/1745324327392.png">
<meta property="og:image" content="http://example.com/images/1745325155432.png">
<meta property="og:image" content="http://example.com/images/1745325573947.png">
<meta property="og:image" content="http://example.com/images/1745325824827.png">
<meta property="og:image" content="http://example.com/images/1745326482760.png">
<meta property="og:image" content="http://example.com/images/1745326759404.png">
<meta property="og:image" content="http://example.com/images/1745328385437.png">
<meta property="og:image" content="http://example.com/images/1745328959351.png">
<meta property="og:image" content="http://example.com/images/1745399918845.png">
<meta property="og:image" content="http://example.com/images/1745407948974.png">
<meta property="og:image" content="http://example.com/images/1745408106792.png">
<meta property="og:image" content="http://example.com/images/1745409074407.png">
<meta property="og:image" content="http://example.com/images/1745409114712.png">
<meta property="og:image" content="http://example.com/images/1745409432852.png">
<meta property="og:image" content="http://example.com/images/1745410850025.png">
<meta property="og:image" content="http://example.com/images/1745412872294.png">
<meta property="og:image" content="http://example.com/images/1745413174001.png">
<meta property="og:image" content="http://example.com/images/1745413842143.png">
<meta property="og:image" content="http://example.com/images/1745413846609.png">
<meta property="og:image" content="http://example.com/images/1745414221168.png">
<meta property="og:image" content="http://example.com/images/1745414261675.png">
<meta property="og:image" content="http://example.com/images/1745414680683.png">
<meta property="og:image" content="http://example.com/images/1745414691190.png">
<meta property="og:image" content="http://example.com/images/1745414854344.png">
<meta property="og:image" content="http://example.com/images/1745415217577.png">
<meta property="og:image" content="http://example.com/images/1745415224492.png">
<meta property="og:image" content="http://example.com/images/1745415303858.png">
<meta property="og:image" content="http://example.com/images/1745416290604.png">
<meta property="og:image" content="http://example.com/images/1745417696316.png">
<meta property="og:image" content="http://example.com/images/1745417655094.png">
<meta property="og:image" content="http://example.com/images/1745417661240.png">
<meta property="og:image" content="http://example.com/images/1745462488883.png">
<meta property="og:image" content="http://example.com/images/1745462495038.png">
<meta property="og:image" content="http://example.com/images/1745462627940.png">
<meta property="og:image" content="http://example.com/images/1745464182166.png">
<meta property="og:image" content="http://example.com/images/1745464194742.png">
<meta property="og:image" content="http://example.com/images/1745464800531.png">
<meta property="og:image" content="http://example.com/images/1745464810193.png">
<meta property="og:image" content="http://example.com/images/1745482203132.png">
<meta property="og:image" content="http://example.com/images/1745482218302.png">
<meta property="og:image" content="http://example.com/images/1745485002041.png">
<meta property="og:image" content="http://example.com/images/1745485521046.png">
<meta property="og:image" content="http://example.com/images/1745485707690.png">
<meta property="og:image" content="http://example.com/images/1745485954758.png">
<meta property="og:image" content="http://example.com/images/1745485856243.png">
<meta property="og:image" content="http://example.com/images/1745486060927.png">
<meta property="og:image" content="http://example.com/images/1745486855532.png">
<meta property="og:image" content="http://example.com/images/1745486861175.png">
<meta property="og:image" content="http://example.com/images/1745487894468.png">
<meta property="og:image" content="http://example.com/images/1745489517544.png">
<meta property="og:image" content="http://example.com/images/1745490048648.png">
<meta property="og:image" content="http://example.com/images/1745493812637.png">
<meta property="og:image" content="http://example.com/images/1745494222711.png">
<meta property="og:image" content="http://example.com/images/1745494405151.png">
<meta property="og:image" content="http://example.com/images/1745494634283.png">
<meta property="og:image" content="http://example.com/images/1745494641054.png">
<meta property="og:image" content="http://example.com/images/1745495182878.png">
<meta property="og:image" content="http://example.com/images/1745495227641.png">
<meta property="og:image" content="http://example.com/images/1745496237530.png">
<meta property="og:image" content="http://example.com/images/1745496242345.png">
<meta property="og:image" content="http://example.com/images/1745496377636.png">
<meta property="og:image" content="http://example.com/images/1745496384262.png">
<meta property="og:image" content="http://example.com/images/1745496890627.png">
<meta property="og:image" content="http://example.com/images/1745496898012.png">
<meta property="og:image" content="http://example.com/images/1745497550810.png">
<meta property="og:image" content="http://example.com/images/1745497561510.png">
<meta property="og:image" content="http://example.com/images/1745505129866.png">
<meta property="og:image" content="http://example.com/images/1745665075956.png">
<meta property="og:image" content="http://example.com/images/1745667686984.png">
<meta property="og:image" content="http://example.com/images/1745667712667.png">
<meta property="og:image" content="http://example.com/images/1745669826582.png">
<meta property="og:image" content="http://example.com/images/1746328055548.png">
<meta property="og:image" content="http://example.com/images/1746521784842.png">
<meta property="og:image" content="http://example.com/images/1746523139933.png">
<meta property="og:image" content="http://example.com/images/1746524062067.png">
<meta property="og:image" content="http://example.com/images/1746533087697.png">
<meta property="og:image" content="http://example.com/images/1746533110315.png">
<meta property="og:image" content="http://example.com/images/1746533404150.png">
<meta property="og:image" content="http://example.com/images/1746536612225.png">
<meta property="og:image" content="http://example.com/images/1746534309419.png">
<meta property="og:image" content="http://example.com/images/1746538341236.png">
<meta property="og:image" content="http://example.com/images/1746540275711.png">
<meta property="og:image" content="http://example.com/images/1746584130828.png">
<meta property="og:image" content="http://example.com/images/1746599773918.png">
<meta property="og:image" content="http://example.com/images/1746599970662.png">
<meta property="og:image" content="http://example.com/images/1746600188245.png">
<meta property="og:image" content="http://example.com/images/1746603644705.png">
<meta property="og:image" content="http://example.com/images/1746603657255.png">
<meta property="og:image" content="http://example.com/images/1746604206146.png">
<meta property="og:image" content="http://example.com/images/1746604210785.png">
<meta property="og:image" content="http://example.com/images/1746606463893.png">
<meta property="og:image" content="http://example.com/images/1746608726304.png">
<meta property="og:image" content="http://example.com/images/1746608747978.png">
<meta property="og:image" content="http://example.com/images/1746617155288.png">
<meta property="og:image" content="http://example.com/images/1746617310553.png">
<meta property="og:image" content="http://example.com/images/1746617494570.png">
<meta property="og:image" content="http://example.com/images/1746618048570.png">
<meta property="og:image" content="http://example.com/images/1746618123788.png">
<meta property="og:image" content="http://example.com/images/1746618661398.png">
<meta property="og:image" content="http://example.com/images/1746618677705.png">
<meta property="og:image" content="http://example.com/images/1746618897320.png">
<meta property="og:image" content="http://example.com/images/1746618906821.png">
<meta property="og:image" content="http://example.com/images/1746619207834.png">
<meta property="og:image" content="http://example.com/images/1746619215568.png">
<meta property="og:image" content="http://example.com/images/1746619527639.png">
<meta property="og:image" content="http://example.com/images/1746619534899.png">
<meta property="og:image" content="http://example.com/images/1746620109392.png">
<meta property="og:image" content="http://example.com/images/1746620120849.png">
<meta property="og:image" content="http://example.com/images/1746620174631.png">
<meta property="og:image" content="http://example.com/images/1746620184803.png">
<meta property="og:image" content="http://example.com/images/1746621181226.png">
<meta property="og:image" content="http://example.com/images/1746611604321.png">
<meta property="og:image" content="http://example.com/images/1746622646468.png">
<meta property="og:image" content="http://example.com/images/1746625648078.png">
<meta property="og:image" content="http://example.com/images/1746674345139.png">
<meta property="og:image" content="http://example.com/images/1746673297216.png">
<meta property="og:image" content="http://example.com/images/1746673310877.png">
<meta property="og:image" content="http://example.com/images/1746675798382.png">
<meta property="og:image" content="http://example.com/images/1746760464179.png">
<meta property="og:image" content="http://example.com/images/1746693809881.png">
<meta property="og:image" content="http://example.com/images/1746694472703.png">
<meta property="og:image" content="http://example.com/images/1746696173714.png">
<meta property="og:image" content="http://example.com/images/1746756608630.png">
<meta property="og:image" content="http://example.com/images/1746756661266.png">
<meta property="og:image" content="http://example.com/images/1746758081106.png">
<meta property="og:image" content="http://example.com/images/1746758094866.png">
<meta property="og:image" content="http://example.com/images/1746759185244.png">
<meta property="og:image" content="http://example.com/images/1746759237814.png">
<meta property="og:image" content="http://example.com/images/1746759529471.png">
<meta property="og:image" content="http://example.com/images/1746759574300.png">
<meta property="og:image" content="http://example.com/images/1746760427283.png">
<meta property="og:image" content="http://example.com/images/1746760414939.png">
<meta property="og:image" content="http://example.com/images/1746760973382.png">
<meta property="og:image" content="http://example.com/images/1746760983623.png">
<meta property="og:image" content="http://example.com/images/1746761498621.png">
<meta property="og:image" content="http://example.com/images/1746761508658.png">
<meta property="og:image" content="http://example.com/images/1746761844525.png">
<meta property="og:image" content="http://example.com/images/1746765490860.png">
<meta property="og:image" content="http://example.com/images/1746765436398.png">
<meta property="og:image" content="http://example.com/images/1746767353130.png">
<meta property="og:image" content="http://example.com/images/1746768009382.png">
<meta property="og:image" content="http://example.com/images/1746775625330.png">
<meta property="og:image" content="http://example.com/images/1746780043957.png">
<meta property="og:image" content="http://example.com/images/1746780730587.png">
<meta property="og:image" content="http://example.com/images/1746782419411.png">
<meta property="og:image" content="http://example.com/images/1746783137830.png">
<meta property="og:image" content="http://example.com/images/1746783452150.png">
<meta property="og:image" content="http://example.com/images/1746790087311.png">
<meta property="og:image" content="http://example.com/images/1746791317193.png">
<meta property="og:image" content="http://example.com/images/1746794422841.png">
<meta property="og:image" content="http://example.com/images/1746794711366.png">
<meta property="og:image" content="http://example.com/images/1746794809718.png">
<meta property="og:image" content="http://example.com/images/1746794880605.png">
<meta property="og:image" content="http://example.com/images/1746795922010.png">
<meta property="og:image" content="http://example.com/images/1746766535742.png">
<meta property="og:image" content="http://example.com/images/1746797407275.png">
<meta property="og:image" content="http://example.com/images/1746845029665.png">
<meta property="og:image" content="http://example.com/images/1746862452933.png">
<meta property="og:image" content="http://example.com/images/1746868223629.png">
<meta property="og:image" content="http://example.com/images/1746927732794.png">
<meta property="og:image" content="http://example.com/images/1746928022943.png">
<meta property="og:image" content="http://example.com/images/1746929142469.png">
<meta property="og:image" content="http://example.com/images/1746929149670.png">
<meta property="og:image" content="http://example.com/images/1746942667670.png">
<meta property="og:image" content="http://example.com/images/1746942675414.png">
<meta property="og:image" content="http://example.com/images/1746943027366.png">
<meta property="og:image" content="http://example.com/images/1746943037522.png">
<meta property="og:image" content="http://example.com/images/1746943086360.png">
<meta property="og:image" content="http://example.com/images/1746943096460.png">
<meta property="og:image" content="http://example.com/images/1746944298171.png">
<meta property="og:image" content="http://example.com/images/1746944302874.png">
<meta property="og:image" content="http://example.com/images/1746944666072.png">
<meta property="og:image" content="http://example.com/images/1746944678847.png">
<meta property="og:image" content="http://example.com/images/1746946067406.png">
<meta property="og:image" content="http://example.com/images/1746946089252.png">
<meta property="og:image" content="http://example.com/images/1746946119937.png">
<meta property="og:image" content="http://example.com/images/1746946178377.png">
<meta property="og:image" content="http://example.com/images/1746946414186.png">
<meta property="og:image" content="http://example.com/images/1746946471544.png">
<meta property="og:image" content="http://example.com/images/1746946553142.png">
<meta property="og:image" content="http://example.com/images/1746947011955.png">
<meta property="og:image" content="http://example.com/images/1746947035974.png">
<meta property="og:image" content="http://example.com/images/1746947355330.png">
<meta property="og:image" content="http://example.com/images/1746947468632.png">
<meta property="og:image" content="http://example.com/images/1746947865158.png">
<meta property="og:image" content="http://example.com/images/1746947892112.png">
<meta property="og:image" content="http://example.com/images/1746951312167.png">
<meta property="og:image" content="http://example.com/images/1746951330197.png">
<meta property="og:image" content="http://example.com/images/1746952050089.png">
<meta property="og:image" content="http://example.com/images/1746952075004.png">
<meta property="og:image" content="http://example.com/images/1746952698717.png">
<meta property="og:image" content="http://example.com/images/1746953372420.png">
<meta property="og:image" content="http://example.com/images/1746953666675.png">
<meta property="og:image" content="http://example.com/images/1746955165756.png">
<meta property="og:image" content="http://example.com/images/1746955175348.png">
<meta property="og:image" content="http://example.com/images/1746956075324.png">
<meta property="og:image" content="http://example.com/images/1746956081375.png">
<meta property="og:image" content="http://example.com/images/1746955863217.png">
<meta property="og:image" content="http://example.com/images/1746955899233.png">
<meta property="og:image" content="http://example.com/images/1746956453580.png">
<meta property="og:image" content="http://example.com/images/1746957428963.png">
<meta property="og:image" content="http://example.com/images/1746957444612.png">
<meta property="og:image" content="http://example.com/images/1746958359503.png">
<meta property="og:image" content="http://example.com/images/1746958238107.png">
<meta property="og:image" content="http://example.com/images/1746958289225.png">
<meta property="og:image" content="http://example.com/images/1746964911135.png">
<meta property="og:image" content="http://example.com/images/1746943160704.png">
<meta property="og:image" content="http://example.com/images/1746943145231.png">
<meta property="og:image" content="http://example.com/images/1746943655959.png">
<meta property="og:image" content="http://example.com/images/1746943668121.png">
<meta property="og:image" content="http://example.com/images/1746929159896.png">
<meta property="og:image" content="http://example.com/images/1746929172747.png">
<meta property="og:image" content="http://example.com/images/1746929185793.png">
<meta property="og:image" content="http://example.com/images/1747027035668.png">
<meta property="og:image" content="http://example.com/images/1747028856462.png">
<meta property="og:image" content="http://example.com/images/1747033414288.png">
<meta property="og:image" content="http://example.com/images/1747035654504.png">
<meta property="og:image" content="http://example.com/images/1747038300915.png">
<meta property="og:image" content="http://example.com/images/1747045273563.png">
<meta property="og:image" content="http://example.com/images/1747049645135.png">
<meta property="og:image" content="http://example.com/images/1747050240024.png">
<meta property="og:image" content="http://example.com/images/1747050637917.png">
<meta property="og:image" content="http://example.com/images/1747050968233.png">
<meta property="og:image" content="http://example.com/images/1747051206382.png">
<meta property="og:image" content="http://example.com/images/1747051442365.png">
<meta property="og:image" content="http://example.com/images/1747051890132.png">
<meta property="og:image" content="http://example.com/images/1747053400880.png">
<meta property="og:image" content="http://example.com/images/1747053637603.png">
<meta property="og:image" content="http://example.com/images/1747055495698.png">
<meta property="og:image" content="http://example.com/images/1747055478183.png">
<meta property="og:image" content="http://example.com/images/1747056341517.png">
<meta property="og:image" content="http://example.com/images/1747058459100.png">
<meta property="og:image" content="http://example.com/images/1747058995292.png">
<meta property="og:image" content="http://example.com/images/1747059227213.png">
<meta property="og:image" content="http://example.com/images/1747376110209.png">
<meta property="og:image" content="http://example.com/images/1747466127878.png">
<meta property="article:published_time" content="2025-05-17T12:00:00.000Z">
<meta property="article:modified_time" content="2025-05-20T07:58:03.392Z">
<meta property="article:author" content="hzbing">
<meta property="article:tag" content="项目">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/images/1743939194177.png">
  
  
  
  <title>单卡到多卡success!!! - 一拳超人</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>一拳超人</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/cs.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="单卡到多卡success!!!"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-05-17 20:00" pubdate>
          2025年5月17日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          6.9k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          58 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">单卡到多卡success!!!</h1>
            
            
              <div class="markdown-body">
                
                <p>测试halo &#x3D; 2 验证结果 ，边界上的值不用验证，验证通过。</p>
<p>但是边界上的值计算了吗？边界上的值不用计算，再看看demo，设置合理范围。</p>
<p>2025年4月5日20:48:29</p>
<p>halo区不统一，核函数中对不同数组计算下标的时候怎么办？</p>
<p>将HLAO统一设置为2 ，所有的三维以上数组设置2的halo区，以便统一下标计算方式。</p>
<p>halo &#x3D; 1 的数组设置为halo &#x3D; 2 </p>
<p>halo &#x3D; 0 的数组，也设置halo &#x3D; 2 ，但只是显存中设置了halo区，不用halo通信，为了统一下标。</p>
<p>​    int z &#x3D; blockIdx.z * blockDim.z + threadIdx.z + HALO;</p>
<p>​    int y &#x3D; blockIdx.y * blockDim.y + threadIdx.y + HALO;</p>
<p>​    int x &#x3D; blockIdx.x * blockDim.x + threadIdx.x + HALO;</p>
<p>虽然xy方向上没有设置halo区，但是在核函数依旧要+HALO，因为边界上的值不用进行stencil计算，+halo跳过边界。</p>
<p>明天改核函数</p>
<p>demo中加上二维数组测试。可不可行？</p>
<p>2025年4月6日14:54:43</p>
<p>先不加了</p>
<p>核函数范围改完了</p>
<p>我先不算，先保证传输过去的数据是正确的，怎么保证正确性呢，把数据传过去，再传回来，验证是不是值没变</p>
<p>先验证三维数组</p>
<p>注释掉，一点点排查</p>
<p>数组越界，有可能是传入的时候出了问题</p>
<p>halo区定义了，但是没有传入数据。</p>
<p>分配完显存内存后，给所有的值设置为0，包括halo区</p>
<p><img src="/../images/1743939194177.png" srcset="/img/loading.gif" lazyload alt="1743939194177"></p>
<p>con自己的问题，传输的时候前面还有个3，按照k方向分块的话要分三次传</p>
<p>单独验证了us 和 x 都有内存越界错误。</p>
<p>明天找越界的原因fight！</p>
<p>2025年4月9日15:37:23</p>
<p>89&#x2F;4 &#x3D; 22.</p>
<p>halo &#x3D; 2</p>
<p>22 + 2* 2 &#x3D; 26</p>
<table>
<thead>
<tr>
<th>i</th>
<th>k_start</th>
<th>k_end</th>
<th>local_k</th>
<th>base_k</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>0</td>
<td>22</td>
<td>26</td>
<td>22</td>
</tr>
<tr>
<td>1</td>
<td>22</td>
<td>44</td>
<td>26</td>
<td>22</td>
</tr>
<tr>
<td>2</td>
<td>44</td>
<td>66</td>
<td>26</td>
<td>22</td>
</tr>
<tr>
<td>3</td>
<td>66</td>
<td>89</td>
<td>27</td>
<td>22</td>
</tr>
</tbody></table>
<p>k &#x3D; 2 不错，&#x3D;3就错</p>
<p>main中memcpy被注释掉了</p>
<p>再核对一遍int double</p>
<p>demo 中不加memcpy不加halo通信，出现了一样的错误</p>
<p>加上memcpy 后没有错误了。！！！！</p>
<p>为什么申请了内存不memcpy也有错误？</p>
<p>在memcpy前申请就没错误。什么原理。</p>
<p>2025年4月10日15:57:57</p>
<p>没有解决不了的问题。</p>
<p>改con要分三次传输</p>
<p><img src="/../images/1744271955209.png" srcset="/img/loading.gif" lazyload alt="1744271955209"></p>
<p>HIP error: invalid argument in file memcpy.cpp at line 577</p>
<p>这个错误说明memcpy函数参数的范围有问题</p>
<p><img src="/../images/1744275765343.png" srcset="/img/loading.gif" lazyload alt="1744275765343"></p>
<p>显存的k是不是没有这么大啊，不是*kbnd_R</p>
<p>显存大小：3 * local_k *  (*jbnd_R) * (*ibnd_R) * 5</p>
<p>我马上毕业了，我还有个很好的女朋友，坚持一下</p>
<p>还是那个错误，和在哪分配显存没有关系</p>
<p>分配完显存，为什么我用不了它</p>
<p>用openmp测试</p>
<p>con写错了，con还是设置halo区</p>
<p>没有加hipinit（0），所以访问越界</p>
<p>我也很幸福不是吗？有人爱我</p>
<p>con 访问错误，con[1]是对的，说明申请了内存，只是访问的时候越界了，先不memcpy看看对不对，</p>
<p><img src="/../images/1744285669542.png" srcset="/img/loading.gif" lazyload alt="1744285669542"></p>
<p>con memcpy 的时候设置了halo区，正确了，没有访问错误</p>
<p>all_prim没错误了，前提是memcpy中没加halo通信</p>
<p>慢慢打开halo通信，从den开始</p>
<p>上面的local_k 传入的为1 </p>
<p>这时核函数没被执行，所以对</p>
<p>设置为传入正常值后，有错误，还是访问错误，但是halo区通信没有错误。</p>
<p>就是核函数的错误。</p>
<p>设置为den[1]后也有错误，说明什么</p>
<p>写一个最少的实现，往里加代码</p>
<p>核函数用之前的调用方法，没有错误。why？</p>
<p>流创建的位置是不是有问题</p>
<p>进度con con2 传回 无错误。</p>
<p>2025年4月11日10:44:55</p>
<p><img src="/../images/1744339496709.png" srcset="/img/loading.gif" lazyload alt="1744339496709"></p>
<p>halo区设置和访问有没有问题。</p>
<p>没复制进去又是什么鬼</p>
<p>con全是0，说明没有计算还是没有传入</p>
<p>传入前也是0，但是在第一轮计算中，con被den赋值了，所以输出不应该是0 </p>
<p>就看con，在all_prim_con前后的值，后面应该有变化才对，不应该全是0</p>
<p>核函数后，正常情况是有值的。但是输出结果con全是0</p>
<p>说明核函数的范围没写好，或者是block和grid没设置好。</p>
<p>是计算错误，还是传回来的时候有错误，在核函数中输出con看看值</p>
<p>核函数没启动，这不尴尬了</p>
<p>能启动了，block grid 写反了</p>
<p>运行</p>
<p><img src="/../images/1744373137255.png" srcset="/img/loading.gif" lazyload alt="1744373137255"></p>
<p>问题出在Flux_x_FVM3里面</p>
<p>哪的问题RK注释了还有问题</p>
<p>再看吧。。。</p>
<p>2025年4月13日15:26:07</p>
<p>要限制k的范围。</p>
<p><img src="/../images/1744532889327.png" srcset="/img/loading.gif" lazyload alt="1744532889327"></p>
<p>限制第一块和第4块卡中k的范围，不能越界</p>
<p><img src="/../images/1744532952060.png" srcset="/img/loading.gif" lazyload alt="1744532952060"></p>
<p>传入一个全局k的坐标</p>
<p>start_k + k - HALO &gt;&#x3D;*inter_kL-1 &amp;&amp; start_k + k - HALO &lt;&#x3D; *inter_kR-1 &amp;&amp; k &lt; local_k - HALO</p>
<p>demo测试，不算全部k的值，算中间一块。通过。</p>
<p>2025年4月14日14:54:26</p>
<p>do it </p>
<p><img src="/../images/1744620939997.png" srcset="/img/loading.gif" lazyload alt="1744620939997"></p>
<p>side的值有错误，输出了有的值为-100</p>
<p>说明cutface[index3D] 或者是 imark[index3D] 或者是 cut_model[index3D] 的偏移量有错误</p>
<p>但是偏移量的计算方法和demo一样，只是xy没加+halo，这个无所谓。因为demo中要跳过halo区，stencil计算要算内部的值，所以这个没问题。</p>
<p>有可能是halo通信出了问题，先注释掉halo通信，试试可不可行，因为这个地方还没有用到周围的值。</p>
<p>2025年4月17日20:55:45</p>
<p>取到的值少了，没有算到所有的值，修改了grid的大小，取到的所有的值，还溢出了，取到了side &#x3D; -100的值。所以导致了显存访问错误。</p>
<p>2025年4月19日11:49:01</p>
<p><img src="/../images/1745034913911.png" srcset="/img/loading.gif" lazyload alt="1745034913911"></p>
<p>i&#x3D;24,j&#x3D;73,k&#x3D;47 不应该出现，找到从哪里开始没有限制到这个下标。</p>
<p><img src="/../images/1745038132088.png" srcset="/img/loading.gif" lazyload alt="1745038132088"></p>
<p>没限制住，源代码这里限制住了这个下标。说明xyzside的memcpy有问题，还是index4Dx有问题？</p>
<p><img src="/../images/1745041416805.png" srcset="/img/loading.gif" lazyload alt="1745041416805"></p>
<p><img src="/../images/1745041399822.png" srcset="/img/loading.gif" lazyload alt="1745041399822"></p>
<p>这里没有* 3 ！！！</p>
<p>US1没有问题了</p>
<p>xyzside HALO通信有错误，没* 3 </p>
<p>*3 后 US1 也没问题了</p>
<p>验证US2 </p>
<p>有错误，</p>
<p><img src="/../images/1745045485235.png" srcset="/img/loading.gif" lazyload alt="1745045485235"></p>
<p>不该取这个下标</p>
<p>i&#x3D;24,j&#x3D;52,k&#x3D;43</p>
<p><img src="/../images/1745046145504.png" srcset="/img/loading.gif" lazyload alt="1745046145504"></p>
<p>xyzside 有问题，该限制的地方没有限制上，使用了halo区的数据，说明halo数据交换有问题。</p>
<p><img src="/../images/1745050315934.png" srcset="/img/loading.gif" lazyload alt="1745050315934"></p>
<p>输出的行数每次都不一样，说明每次使用到的线程数量都不同。</p>
<p>没显示完全是因为没有同步，在每个设备中都加入同步语句就可以看到所有的输出。</p>
<p>检查US2</p>
<p>i&#x3D;22,j&#x3D;36,k&#x3D;43,index3D&#x3D;243290,k_start&#x3D;22,side&#x3D;0</p>
<p>不该出现这个</p>
<p><img src="/../images/1745063419053.png" srcset="/img/loading.gif" lazyload alt="1745063419053"></p>
<p><img src="/../images/1745063432190.png" srcset="/img/loading.gif" lazyload alt="1745063432190"></p>
<p>halo没交换到数据</p>
<p>43 是从 44 交换过来的</p>
<p>43 44 都是 -100</p>
<p>我的程序，43 是 0 ，44 是-100</p>
<p>说明没交换过来</p>
<p>44是卡2 的开始</p>
<p><img src="/../images/1745063786691.png" srcset="/img/loading.gif" lazyload alt="1745063786691"></p>
<p>都是k &#x3D; 43 的时候为0 </p>
<p>说明卡1底部接收从卡2顶部交换数据的时候出错。</p>
<p>看看其他数组k&#x3D;43 有问题吗。</p>
<p>imark，k&#x3D;43也没交换成功</p>
<p>demo：64</p>
<p>0,16,32,48</p>
<p>demo HALO交换没问题</p>
<p>加上了点对点通信设置</p>
<p>再改函数试试</p>
<p>openmp </p>
<p>启动函数</p>
<p>for循环和Openmp不同，要传输完毕再数据交换</p>
<p>halo设置为2</p>
<p>能运行了，只是发散了，说明哪个地方算错了</p>
<p><img src="/../images/1745110453352.png" srcset="/img/loading.gif" lazyload alt="1745110453352"></p>
<p>2025年4月20日08:54:18</p>
<p>flux_US赋值和取值 是在一个卡中进行的吗，会不会取值的时候用到其他卡中的下标？</p>
<p>2025年4月22日15:25:00</p>
<p><img src="/../images/1745322298083.png" srcset="/img/loading.gif" lazyload alt="1745322298083"></p>
<p>运行一步，一个RK</p>
<p>con2的值有偏差。</p>
<p>找一个下标进行研究，看看到底哪里出了问题。</p>
<p><img src="/../images/1745322348260.png" srcset="/img/loading.gif" lazyload alt="1745322348260"></p>
<p><img src="/../images/1745322547279.png" srcset="/img/loading.gif" lazyload alt="1745322547279"></p>
<p>找到哪个分支改了con2的值，imark为多少 ct_level_US为多少</p>
<p><img src="/../images/1745322916856.png" srcset="/img/loading.gif" lazyload alt="1745322916856"></p>
<p><img src="/../images/1745322980331.png" srcset="/img/loading.gif" lazyload alt="1745322980331"></p>
<p><img src="/../images/1745323027495.png" srcset="/img/loading.gif" lazyload alt="1745323027495"></p>
<p>dx,dy,dz 没有halo区</p>
<p>还有没设置halo区的数据</p>
<p>假设k&#x3D;1取到的是第一个数据，但是dz[1]取到的是第二个数据 ，正确应该是取dz[0]。</p>
<p>所以要这样dz[k-1]</p>
<p>dx ,dy 不用管</p>
<p>i&#x3D; 0 就是第一个数据</p>
<p>所有出现dz的地方都要改，先改RK中的dz，看看是否还是有偏差</p>
<p>改了RK中的dz，这个下标没错误了，但是大部分的下标还是有错误。</p>
<p>再改F_z中的dz</p>
<p>还是有错误</p>
<p><img src="/../images/1745324327392.png" srcset="/img/loading.gif" lazyload alt="1745324327392"></p>
<p>all_con_2_prim里面也改了dz</p>
<p><img src="/../images/1745325155432.png" srcset="/img/loading.gif" lazyload alt="1745325155432"></p>
<p>不对，这里是将con的值赋给den等数组。con 的值没变化</p>
<p>找<img src="/../images/1745325573947.png" srcset="/img/loading.gif" lazyload alt="1745325573947">这个下标</p>
<p><img src="/../images/1745325824827.png" srcset="/img/loading.gif" lazyload alt="1745325824827"></p>
<p>不是-1,是减HALO</p>
<p>改完，还是有误差</p>
<p><img src="/../images/1745326482760.png" srcset="/img/loading.gif" lazyload alt="1745326482760"></p>
<p>再找</p>
<p><img src="/../images/1745326759404.png" srcset="/img/loading.gif" lazyload alt="1745326759404"></p>
<p>dz应该是全局的k</p>
<p>start_k + k - HALO</p>
<p><img src="/../images/1745328385437.png" srcset="/img/loading.gif" lazyload alt="1745328385437"></p>
<p>没误差了！！！</p>
<p>输出25步算误差~~~</p>
<p><img src="/../images/1745328959351.png" srcset="/img/loading.gif" lazyload alt="1745328959351"></p>
<p>还是有误差</p>
<p>我输出了RK &#x3D; 1 和 RK &#x3D; 2 的con2的值，并进行了对比，都没问题。</p>
<p>说明con没有问题</p>
<p>赋值给den等数组的时候出现了错误吗。</p>
<p>输出pre的值</p>
<p>RK &#x3D; 1 没问题</p>
<p>RK &#x3D; 2 也没问题</p>
<p>跑2000步试试，到底是什么原因，结果都没错误。</p>
<p>一步不能说明原因吗？</p>
<p>2025年4月23日17:18:37</p>
<p><img src="/../images/1745399918845.png" srcset="/img/loading.gif" lazyload alt="1745399918845"></p>
<p>再测一遍</p>
<p>运行一步，pre的值对了就对了。</p>
<p>RK&#x3D;1 没问题</p>
<p>RK&#x3D;2 也没问题</p>
<p>跑个5步看看结果 </p>
<p>istep&#x3D;5，RK &#x3D; 1 </p>
<p><img src="/../images/1745407948974.png" srcset="/img/loading.gif" lazyload alt="1745407948974"></p>
<p>误差较大</p>
<p>istep&#x3D;2，RK &#x3D; 1 </p>
<p><img src="/../images/1745408106792.png" srcset="/img/loading.gif" lazyload alt="1745408106792"></p>
<p>说明到第二轮的时候就出错了</p>
<p>查看计算前是否就错了，在计算前输出</p>
<p>pre没有偏差，但是这个circle1的输出在第4步有偏差</p>
<p><img src="/../images/1745409074407.png" srcset="/img/loading.gif" lazyload alt="1745409074407"></p>
<p><img src="/../images/1745409114712.png" srcset="/img/loading.gif" lazyload alt="1745409114712"></p>
<p>说明第二轮传入的没有问题，但是计算后有问题。还是计算的问题。</p>
<p>找计算错误的下标。</p>
<p><img src="/../images/1745409432852.png" srcset="/img/loading.gif" lazyload alt="1745409432852"></p>
<p>输出con</p>
<p>没有错误</p>
<p>输出con2</p>
<p>con2也没错误，但是pre，有错误，说明在con给pre赋值的时候出现了错误。</p>
<p><img src="/../images/1745410850025.png" srcset="/img/loading.gif" lazyload alt="1745410850025"></p>
<p><img src="/../images/1745412872294.png" srcset="/img/loading.gif" lazyload alt="1745412872294"></p>
<p>验证这个下标</p>
<p><img src="/../images/1745413174001.png" srcset="/img/loading.gif" lazyload alt="1745413174001"></p>
<p><img src="/../images/1745413842143.png" srcset="/img/loading.gif" lazyload alt="1745413842143"></p>
<p><img src="/../images/1745413846609.png" srcset="/img/loading.gif" lazyload alt="1745413846609"></p>
<p><img src="/../images/1745414221168.png" srcset="/img/loading.gif" lazyload alt="1745414221168"></p>
<p><img src="/../images/1745414261675.png" srcset="/img/loading.gif" lazyload alt="1745414261675"></p>
<p><img src="/../images/1745414680683.png" srcset="/img/loading.gif" lazyload alt="1745414680683"></p>
<p><img src="/../images/1745414691190.png" srcset="/img/loading.gif" lazyload alt="1745414691190"></p>
<p><img src="/../images/1745414854344.png" srcset="/img/loading.gif" lazyload alt="1745414854344"></p>
<p><img src="/../images/1745415217577.png" srcset="/img/loading.gif" lazyload alt="1745415217577"></p>
<p><img src="/../images/1745415224492.png" srcset="/img/loading.gif" lazyload alt="1745415224492"></p>
<p>还是con2算错了，应该是0来着，但是有值了</p>
<p>就看这个下标<img src="/../images/1745415303858.png" srcset="/img/loading.gif" lazyload alt="1745415303858"></p>
<p>con2输出小数点后15位</p>
<p><img src="/../images/1745416290604.png" srcset="/img/loading.gif" lazyload alt="1745416290604"></p>
<p>再看没计算前的输出结果</p>
<p>计算前没有错误。</p>
<p>说明在第2 步RK等于1的时候，对con2 的计算出现了错误。</p>
<p><img src="/../images/1745417696316.png" srcset="/img/loading.gif" lazyload alt="1745417696316"></p>
<p><img src="/../images/1745417655094.png" srcset="/img/loading.gif" lazyload alt="1745417655094"></p>
<p><img src="/../images/1745417661240.png" srcset="/img/loading.gif" lazyload alt="1745417661240"></p>
<p>输出全部的值。</p>
<p><img src="/../images/1745462488883.png" srcset="/img/loading.gif" lazyload alt="1745462488883"></p>
<p><img src="/../images/1745462495038.png" srcset="/img/loading.gif" lazyload alt="1745462495038"></p>
<p>Lcon的值不同，应该为0才对。</p>
<p><code>con2[1][65][63][33][3],这个下标</code></p>
<p><img src="/../images/1745462627940.png" srcset="/img/loading.gif" lazyload alt="1745462627940"></p>
<p><code>Lcon[65][63][33][3]</code></p>
<p>fx3中的Lcon没错误都是0</p>
<p>fy3也全是0</p>
<p>fz3</p>
<p><img src="/../images/1745464182166.png" srcset="/img/loading.gif" lazyload alt="1745464182166"></p>
<p><img src="/../images/1745464194742.png" srcset="/img/loading.gif" lazyload alt="1745464194742"></p>
<p>这里有问题</p>
<p>不止是第三个值有问题，第一个值也有问题，说明在第一步RK&#x3D;1的时候，赋值给Lcon的值就有错误。</p>
<p>xy都没问题，z有问题。</p>
<p><img src="/../images/1745464800531.png" srcset="/img/loading.gif" lazyload alt="1745464800531"></p>
<p><img src="/../images/1745464810193.png" srcset="/img/loading.gif" lazyload alt="1745464810193"></p>
<p>第一个的kr1算错了</p>
<p><code>flux[66][63][33][3]</code>这个错了</p>
<p><img src="/../images/1745482203132.png" srcset="/img/loading.gif" lazyload alt="1745482203132"></p>
<p><img src="/../images/1745482218302.png" srcset="/img/loading.gif" lazyload alt="1745482218302"></p>
<p>flux,65的kr1 和66 的值为什么不一样</p>
<p>重新测试</p>
<p>65</p>
<p><img src="/../images/1745485002041.png" srcset="/img/loading.gif" lazyload alt="1745485002041"></p>
<p><img src="/../images/1745485521046.png" srcset="/img/loading.gif" lazyload alt="1745485521046"></p>
<p>z2算完之后已经错了</p>
<p>在z1后输出</p>
<p><img src="/../images/1745485707690.png" srcset="/img/loading.gif" lazyload alt="1745485707690"></p>
<p><img src="/../images/1745485954758.png" srcset="/img/loading.gif" lazyload alt="1745485954758"></p>
<p>z1后也错了</p>
<p>在z1前输出</p>
<p><img src="/../images/1745485856243.png" srcset="/img/loading.gif" lazyload alt="1745485856243"></p>
<p><img src="/../images/1745486060927.png" srcset="/img/loading.gif" lazyload alt="1745486060927"></p>
<p>这里是一样的</p>
<p>说明在z1中算错了</p>
<p>flux kr1没赋值，还是0，应该给他赋值的，也就是应该给66赋值的</p>
<p>在z1后输出66</p>
<p><img src="/../images/1745486855532.png" srcset="/img/loading.gif" lazyload alt="1745486855532"></p>
<p><img src="/../images/1745486861175.png" srcset="/img/loading.gif" lazyload alt="1745486861175"></p>
<p>这个就没问题，是为什么？</p>
<p>在多卡中输出两个</p>
<p><img src="/../images/1745487894468.png" srcset="/img/loading.gif" lazyload alt="1745487894468"></p>
<p>65 和66 不在一个卡中吗</p>
<p>65 + 1 可能是halo区</p>
<p>flux交换了吗，算完还要交换吗？</p>
<p>算完之后要交换，不然z2中用到了周围的数据为0 </p>
<p>65 66 是边界区吗</p>
<p>k_start 0, 22 ,44, 66</p>
<p>65是第三张卡的结束</p>
<p>66是第四张卡的开始</p>
<p>在z1后加上一个halo交换，交换周围的数据，因为z2中要用到周围的数据</p>
<p><img src="/../images/1745489517544.png" srcset="/img/loading.gif" lazyload alt="1745489517544"></p>
<p>好了！！！</p>
<p>验证25步</p>
<p><img src="/../images/1745490048648.png" srcset="/img/loading.gif" lazyload alt="1745490048648"></p>
<p>还是有误差，马上了</p>
<p>输出第2步 RK&#x3D;1计算完后的con2结果对比</p>
<p><img src="/../images/1745493812637.png" srcset="/img/loading.gif" lazyload alt="1745493812637"></p>
<p>就这几个，其他都没问题。</p>
<p>43 是边界。</p>
<p>1步 2RK没有错误。</p>
<p><img src="/../images/1745494222711.png" srcset="/img/loading.gif" lazyload alt="1745494222711"></p>
<p>研究这个下标</p>
<p><img src="/../images/1745494405151.png" srcset="/img/loading.gif" lazyload alt="1745494405151"></p>
<p><img src="/../images/1745494634283.png" srcset="/img/loading.gif" lazyload alt="1745494634283"></p>
<p><img src="/../images/1745494641054.png" srcset="/img/loading.gif" lazyload alt="1745494641054"></p>
<p>说明第一步RK &#x3D; 1 的时候Lcon就出错了</p>
<p>在11 的时候输出Lcon</p>
<p><code>Lcon[43][29][43][3]</code></p>
<p><img src="/../images/1745495182878.png" srcset="/img/loading.gif" lazyload alt="1745495182878"></p>
<p><img src="/../images/1745495227641.png" srcset="/img/loading.gif" lazyload alt="1745495227641"></p>
<p>11就出错了，再往前找</p>
<p>z1后面交换完没错</p>
<p><img src="/../images/1745496237530.png" srcset="/img/loading.gif" lazyload alt="1745496237530"></p>
<p><img src="/../images/1745496242345.png" srcset="/img/loading.gif" lazyload alt="1745496242345"></p>
<p>z2后面</p>
<p><img src="/../images/1745496377636.png" srcset="/img/loading.gif" lazyload alt="1745496377636"></p>
<p><img src="/../images/1745496384262.png" srcset="/img/loading.gif" lazyload alt="1745496384262"></p>
<p>这里错了</p>
<p><img src="/../images/1745496890627.png" srcset="/img/loading.gif" lazyload alt="1745496890627"></p>
<p><img src="/../images/1745496898012.png" srcset="/img/loading.gif" lazyload alt="1745496898012"></p>
<p>符合</p>
<p>输出flux_US….</p>
<p><img src="/../images/1745497550810.png" srcset="/img/loading.gif" lazyload alt="1745497550810"></p>
<p><img src="/../images/1745497561510.png" srcset="/img/loading.gif" lazyload alt="1745497561510"></p>
<p>flux的下标计算对了，但是flux_US的值为0</p>
<p>1是flux_US 计算的错误</p>
<p>2还是计算的下标在另一个卡中，flux_US需要交换数据。flux_US怎么交换数据。</p>
<p>flux_US计算应该没有问题，所以是第二种错误，计算的下标和用到的下标不在同一个卡中</p>
<p>需要交换两个卡中flux_US的数据。</p>
<p>将不是0 的值，传输到另一个卡中。</p>
<p>算完卡1 后将结果传回，然后传入卡二中，最后算完卡4，将结果传回，传入卡123中。</p>
<p><img src="/../images/1745505129866.png" srcset="/img/loading.gif" lazyload alt="1745505129866"></p>
<p>看第一个是对的</p>
<p>25步没误差</p>
<p>2025年4月26日18:57:54</p>
<p><img src="/../images/1745665075956.png" srcset="/img/loading.gif" lazyload alt="1745665075956"></p>
<p>运行错误。</p>
<p>25步没有误差</p>
<p><img src="/../images/1745667686984.png" srcset="/img/loading.gif" lazyload alt="1745667686984"></p>
<p>225步</p>
<p><img src="/../images/1745667712667.png" srcset="/img/loading.gif" lazyload alt="1745667712667"></p>
<p>在test里面输出，哪一步，哪个RK，开始出现误差的。</p>
<p>25步，RK &#x3D; 2 ，con2没问题</p>
<p><img src="/../images/1745669826582.png" srcset="/img/loading.gif" lazyload alt="1745669826582"></p>
<p>找这个下标</p>
<p><code>imark[54][71][41]</code></p>
<p>2025年4月28日17:14:20</p>
<p>2025年5月4日11:06:58</p>
<p>diff3 之前对比的结果，误差越往后越大，所以才导致程序的运行中断。</p>
<p><img src="/../images/1746328055548.png" srcset="/img/loading.gif" lazyload alt="1746328055548"></p>
<p>325 &gt; 326这一步出了问题</p>
<p>如果改成openmp是不是就没错误了。可以试试</p>
<p>2025年5月6日09:27:15</p>
<p>跑到三百多步有误差，而前面没有误差，不一定说明前面没算错，第一步是出了问题的（但是又验证了一遍，第一步一点问题没有。0.0）<br>k+1对下一个元素赋值的时候，只是对halo区赋了值，并没有将halo区的值更新到下一个卡的有效地址。<br><strong>改成openmp再试试。</strong></p>
<p>总是有奇奇怪怪的依赖关系，找出这些关系。还有什么地方<br>留意所有k+1的地方，在这些地方输出做对比<br>分阶段输出值，找到值不一样的地方。</p>
<p>将Lcon的值算完后传回，看看是不是对的</p>
<p>istep &#x3D; 1 ,RK &#x3D; 1 fluid &#x3D; 1 </p>
<p><img src="/../images/1746521784842.png" srcset="/img/loading.gif" lazyload alt="1746521784842"></p>
<p>比较全部的值。</p>
<p>完全一样</p>
<p><img src="/../images/1746523139933.png" srcset="/img/loading.gif" lazyload alt="1746523139933"></p>
<p>flux也一样</p>
<p>flux_US呢</p>
<p><img src="/../images/1746524062067.png" srcset="/img/loading.gif" lazyload alt="1746524062067"></p>
<p>也没问题</p>
<p>fluid &#x3D; 2 </p>
<p>flux_US 没问题,flux没问题，Lcon也没问题</p>
<p>RK &#x3D; 2 </p>
<p>flux_US 没问题,flux没问题，Lcon也没问题</p>
<p>说明第一步都没问题。</p>
<p><img src="/../images/1746533087697.png" srcset="/img/loading.gif" lazyload alt="1746533087697"></p>
<p>这个地方<img src="/../images/1746533110315.png" srcset="/img/loading.gif" lazyload alt="1746533110315"><br>这里对halo区中的元素进行赋值了，但是没有在另一个卡中更新。</p>
<p>！！！前面只是用到了halo区的值，并没有改变halo区的值，这里改变了halo区的值，应该在后一个卡中的有效区域更新这个值。</p>
<p>！！！还有没有halo通信完又计算了这个数组的，并且在计算后又用到了这个数组边界的值，每次计算后都要halo通信，找</p>
<p><img src="/../images/1746533404150.png" srcset="/img/loading.gif" lazyload alt="1746533404150"></p>
<p>这里也要拆成两个，计算完flux后再进行halo通信，先改这个</p>
<p>在每一个flux赋值后都进行了halo交换，z4中更改了Lcon的值。后续没有用到Lcon边界的值，不用进行halo交换。</p>
<p>测试：</p>
<p><img src="/../images/1746536612225.png" srcset="/img/loading.gif" lazyload alt="1746536612225"></p>
<p>但是z2中<img src="/../images/1746534309419.png" srcset="/img/loading.gif" lazyload alt="1746534309419"><br>对halo边界进行了修改。要在后一个卡中也进行修改。然后再更新halo区</p>
<p>测试：</p>
<p><img src="/../images/1746538341236.png" srcset="/img/loading.gif" lazyload alt="1746538341236"></p>
<p>改为openmp</p>
<p>测试：</p>
<p><img src="/../images/1746540275711.png" srcset="/img/loading.gif" lazyload alt="1746540275711"></p>
<p>在后面多输出几次flux_US，检查这个数组真的没问题吗，可能问题出在后面，之前串行的时候就是顺序执行的，应该没问题。</p>
<p>问题出在哪？让我找到你。</p>
<p>再测一遍第一步改为openmp后结果还一样吗</p>
<p>2025年5月7日10:14:50</p>
<p>没问题，就找吧，找到哪一步出的问题 。</p>
<p><img src="/../images/1746584130828.png" srcset="/img/loading.gif" lazyload alt="1746584130828"></p>
<p><code>imark[53][65][44] = 100</code></p>
<p><code>pre[53][65][44][1]</code></p>
<p>找到问题，解决问题</p>
<p>circle1 的t不好找，找这里吧。<img src="/../images/1746599773918.png" srcset="/img/loading.gif" lazyload alt="1746599773918"></p>
<p>再输出一遍，看是不是这里还有问题</p>
<p><img src="/../images/1746599970662.png" srcset="/img/loading.gif" lazyload alt="1746599970662"></p>
<p>突然跑不了了</p>
<p>能跑了，还是这里</p>
<p><img src="/../images/1746600188245.png" srcset="/img/loading.gif" lazyload alt="1746600188245"></p>
<p>输出</p>
<p><img src="/../images/1746603644705.png" srcset="/img/loading.gif" lazyload alt="1746603644705"></p>
<p><img src="/../images/1746603657255.png" srcset="/img/loading.gif" lazyload alt="1746603657255"></p>
<p>RK &#x3D; 2时发生了变化。</p>
<p>再往前输出几步</p>
<p><img src="/../images/1746604206146.png" srcset="/img/loading.gif" lazyload alt="1746604206146"></p>
<p><img src="/../images/1746604210785.png" srcset="/img/loading.gif" lazyload alt="1746604210785"></p>
<p>第一步就不对</p>
<p>是我改成openmp的原因吗</p>
<p>再看看之前的代码</p>
<p>之前的代码没问题，就是openmp的问题。</p>
<p>先用22测</p>
<p>重新找下标。</p>
<p><img src="/../images/1746606463893.png" srcset="/img/loading.gif" lazyload alt="1746606463893"></p>
<p>51，28,  45</p>
<p>找到误差开始的地方，不就能消除误差了吗，做到一致</p>
<p><img src="/../images/1746608726304.png" srcset="/img/loading.gif" lazyload alt="1746608726304"></p>
<p><img src="/../images/1746608747978.png" srcset="/img/loading.gif" lazyload alt="1746608747978"></p>
<p>%.25f 再输出 d2</p>
<p>%.30f输出con，con2第一步完全没问题d3</p>
<p>第二步呢。d4</p>
<p><img src="/../images/1746617155288.png" srcset="/img/loading.gif" lazyload alt="1746617155288"></p>
<p>这里第二步肯定是有问题的</p>
<p>多了一倍！！！</p>
<p><img src="/../images/1746617310553.png" srcset="/img/loading.gif" lazyload alt="1746617310553"></p>
<p>3 3 6</p>
<p><img src="/../images/1746617494570.png" srcset="/img/loading.gif" lazyload alt="1746617494570"></p>
<p>开干吧</p>
<p><img src="/../images/1746618048570.png" srcset="/img/loading.gif" lazyload alt="1746618048570"></p>
<p><img src="/../images/1746618123788.png" srcset="/img/loading.gif" lazyload alt="1746618123788"></p>
<p>Lcon大了一倍</p>
<p><img src="/../images/1746618661398.png" srcset="/img/loading.gif" lazyload alt="1746618661398"></p>
<p><img src="/../images/1746618677705.png" srcset="/img/loading.gif" lazyload alt="1746618677705"></p>
<p>flux多输出小数点几位</p>
<p><img src="/../images/1746618897320.png" srcset="/img/loading.gif" lazyload alt="1746618897320"></p>
<p><img src="/../images/1746618906821.png" srcset="/img/loading.gif" lazyload alt="1746618906821"></p>
<p>.50f</p>
<p><img src="/../images/1746619207834.png" srcset="/img/loading.gif" lazyload alt="1746619207834"></p>
<p><img src="/../images/1746619215568.png" srcset="/img/loading.gif" lazyload alt="1746619215568"></p>
<p>4个</p>
<p><img src="/../images/1746619527639.png" srcset="/img/loading.gif" lazyload alt="1746619527639"></p>
<p><img src="/../images/1746619534899.png" srcset="/img/loading.gif" lazyload alt="1746619534899"></p>
<p>更具体，前面也加一个输出</p>
<p><img src="/../images/1746620109392.png" srcset="/img/loading.gif" lazyload alt="1746620109392"></p>
<p><img src="/../images/1746620120849.png" srcset="/img/loading.gif" lazyload alt="1746620120849"></p>
<p><img src="/../images/1746620174631.png" srcset="/img/loading.gif" lazyload alt="1746620174631"></p>
<p><img src="/../images/1746620184803.png" srcset="/img/loading.gif" lazyload alt="1746620184803"></p>
<p>这里就变了</p>
<p>说明istep &#x3D; 1 , RK &#x3D; 2 的时候的，Lcon的值被前面的x,y函数改变了。x3,y3</p>
<p><img src="/../images/1746621181226.png" srcset="/img/loading.gif" lazyload alt="1746621181226"></p>
<p>y3中还是0，说明</p>
<p>Lcon的值在 istep &#x3D; 1 ,RK &#x3D; 2 ,fluid &#x3D; 2 , y3 - z4 这中间被修改了。</p>
<p>不可能啊，这中间没有修改Lcon的值</p>
<p>灭法治了。</p>
<p><img src="/../images/1746611604321.png" srcset="/img/loading.gif" lazyload alt="1746611604321"></p>
<p>不行就从这里入手吧。这里太复杂了，不知道谁赋的值</p>
<p>circle1 t.</p>
<p>再测一遍,istep 改为1</p>
<p>唉我去</p>
<p>z3忘了删了。所以出错了。openmp里面也没删。</p>
<p>再测测</p>
<p>Lcon前两步没问题了。</p>
<p>所以，一直往前追溯到con</p>
<p><img src="/../images/1746622646468.png" srcset="/img/loading.gif" lazyload alt="1746622646468"></p>
<p>这个地方</p>
<p>也没错误了。</p>
<p>测试：</p>
<p><img src="/../images/1746625648078.png" srcset="/img/loading.gif" lazyload alt="1746625648078"></p>
<p>54,21,43</p>
<p>openmp测试：</p>
<p><img src="/../images/1746674345139.png" srcset="/img/loading.gif" lazyload alt="1746674345139"></p>
<p>如果测试还不行，就找到下标，每一步都输出这个下标，老方法。</p>
<p>不加openmp 25步 225步都有误差。</p>
<p><img src="/../images/1746673297216.png" srcset="/img/loading.gif" lazyload alt="1746673297216"></p>
<p><img src="/../images/1746673310877.png" srcset="/img/loading.gif" lazyload alt="1746673310877"></p>
<p>就从25步前下手</p>
<p>输出每一步 54,21,43 这个下标，con2的值。</p>
<p>con2相同</p>
<p>那就输出全部的con ,con2的值</p>
<p>istep &#x3D; 1，2都 输出 没有误差</p>
<p>istep &#x3D; 5 输出，有误差，但是误差很小。</p>
<p><img src="/../images/1746675798382.png" srcset="/img/loading.gif" lazyload alt="1746675798382"></p>
<p>这种值得研究吗？</p>
<p>怎么找到误差最大的下标。</p>
<p>25步输出误差也不大。</p>
<p>加上x4,y4，每一个核函数后面都加上flux halo通信</p>
<p>测试：</p>
<p><img src="/../images/1746760464179.png" srcset="/img/loading.gif" lazyload alt="1746760464179"></p>
<p>说明全加上还是有问题。</p>
<p>还能怎么测试？</p>
<p>第一步结束输出结果，计算误差</p>
<p>没误差，第二步也没误差</p>
<p>第10步看看</p>
<p>有误差</p>
<p><img src="/../images/1746693809881.png" srcset="/img/loading.gif" lazyload alt="1746693809881"></p>
<p>第5步</p>
<p><img src="/../images/1746694472703.png" srcset="/img/loading.gif" lazyload alt="1746694472703"></p>
<p>第三步</p>
<p><img src="/../images/1746696173714.png" srcset="/img/loading.gif" lazyload alt="1746696173714"></p>
<p>从istep Rk &#x3D; 2 开始出现误差了。<br>这是哪个值？</p>
<p>3934330行，再输出一遍，给每一个输出加上输出的哪个值</p>
<p>找到后就往前推</p>
<p>2025年5月9日11:36:13</p>
<p><img src="/../images/1746756608630.png" srcset="/img/loading.gif" lazyload alt="1746756608630"></p>
<p><img src="/../images/1746756661266.png" srcset="/img/loading.gif" lazyload alt="1746756661266"></p>
<p>所以3934330行是pre(2,17,22,42)的值，也就是<code>pre[41][21][16][1]</code></p>
<p>在结束istep &#x3D; 3 RK &#x3D; 2后，输出con，con2 的这个值 </p>
<p><img src="/../images/1746758081106.png" srcset="/img/loading.gif" lazyload alt="1746758081106"></p>
<p><img src="/../images/1746758094866.png" srcset="/img/loading.gif" lazyload alt="1746758094866"></p>
<p>RK &#x3D; 1 完全没问题，RK &#x3D;2 就出现误差了。说明这里就是有问题。</p>
<p>往前找</p>
<p><img src="/../images/1746759185244.png" srcset="/img/loading.gif" lazyload alt="1746759185244"></p>
<p><img src="/../images/1746759237814.png" srcset="/img/loading.gif" lazyload alt="1746759237814"></p>
<p>Lcon的问题</p>
<p><img src="/../images/1746759529471.png" srcset="/img/loading.gif" lazyload alt="1746759529471"></p>
<p><img src="/../images/1746759574300.png" srcset="/img/loading.gif" lazyload alt="1746759574300"></p>
<p>con2 和之前测的不一样，先不管这里，反正是Lcon出错了</p>
<p>往前输出Lcon，就看m &#x3D;0 即可</p>
<p><img src="/../images/1746760427283.png" srcset="/img/loading.gif" lazyload alt="1746760427283"></p>
<p><img src="/../images/1746760414939.png" srcset="/img/loading.gif" lazyload alt="1746760414939"></p>
<p>找到了flux kr1 计算错误</p>
<p>在哪计算的这个值，在z2里面，在计算后输出</p>
<p><img src="/../images/1746760973382.png" srcset="/img/loading.gif" lazyload alt="1746760973382"></p>
<p><img src="/../images/1746760983623.png" srcset="/img/loading.gif" lazyload alt="1746760983623"></p>
<p>一样的说明计算后没有问题。但是在使用的时候就有问题了</p>
<p>计算后做了什么</p>
<p>在z3中再输出看看</p>
<p><img src="/../images/1746761498621.png" srcset="/img/loading.gif" lazyload alt="1746761498621"></p>
<p><img src="/../images/1746761508658.png" srcset="/img/loading.gif" lazyload alt="1746761508658"></p>
<p>这里就错了，说明halo 通信有问题。</p>
<p>去掉反向通信，看看输出是不是可以了。</p>
<p><img src="/../images/1746761844525.png" srcset="/img/loading.gif" lazyload alt="1746761844525"></p>
<p>可以了，但是不反向通信还是有错误呀</p>
<p>再测一遍</p>
<p>25误差很小</p>
<p><img src="/../images/1746765490860.png" srcset="/img/loading.gif" lazyload alt="1746765490860"></p>
<p>225还是有误差，</p>
<p><img src="/../images/1746765436398.png" srcset="/img/loading.gif" lazyload alt="1746765436398"></p>
<p>找到误差开始的地方</p>
<p>100步</p>
<p><img src="/../images/1746767353130.png" srcset="/img/loading.gif" lazyload alt="1746767353130"></p>
<p>50步</p>
<p><img src="/../images/1746768009382.png" srcset="/img/loading.gif" lazyload alt="1746768009382"></p>
<p>25步误差还是多了，之前都在小数点后7位</p>
<p>分析一步的误差呢。123没误差</p>
<p>5步 RK &#x3D; 2</p>
<p><img src="/../images/1746775625330.png" srcset="/img/loading.gif" lazyload alt="1746775625330"></p>
<p>什么才算大误差呢</p>
<p>istep  &#x3D; 4 ,RK &#x3D; 2 突然出现误差。</p>
<p><img src="/../images/1746780043957.png" srcset="/img/loading.gif" lazyload alt="1746780043957"></p>
<p>先找找这个误差，如果不行，再找更大的误差，能感觉明显算错的误差。</p>
<p>4144643 <img src="/../images/1746780730587.png" srcset="/img/loading.gif" lazyload alt="1746780730587"></p>
<p>vel_w(2,44,30,44)</p>
<p><code>vel_w[43][29][43][1]</code>,imark &#x3D; 2 </p>
<p>con2完全相同，这里应该不是问题所在。</p>
<p>10步</p>
<p><img src="/../images/1746782419411.png" srcset="/img/loading.gif" lazyload alt="1746782419411"></p>
<p>15步</p>
<p>20步</p>
<p><img src="/../images/1746783137830.png" srcset="/img/loading.gif" lazyload alt="1746783137830"></p>
<p>正常的误差值是多少</p>
<p>25步</p>
<p><img src="/../images/1746783452150.png" srcset="/img/loading.gif" lazyload alt="1746783452150"></p>
<p>还是flux k+1 那个地方对halo区计算了，通信的时候，上次应该是通信错了，把这个地方再改一下</p>
<p>新建一个目录25</p>
<p>对比源 19 25 y a g</p>
<p><img src="/../images/1746790087311.png" srcset="/img/loading.gif" lazyload alt="1746790087311"></p>
<p>25 ag没有误差</p>
<p>225  ya 没有误差  ag有误差</p>
<p><img src="/../images/1746791317193.png" srcset="/img/loading.gif" lazyload alt="1746791317193"></p>
<p>还是看这种大的误差，不要研究小误差。</p>
<p><img src="/../images/1746794422841.png" srcset="/img/loading.gif" lazyload alt="1746794422841"></p>
<p>30 没有,50没有（小数点后7个0），</p>
<p>100 这里就出问题了</p>
<p><img src="/../images/1746794711366.png" srcset="/img/loading.gif" lazyload alt="1746794711366"></p>
<p>150</p>
<p><img src="/../images/1746794809718.png" srcset="/img/loading.gif" lazyload alt="1746794809718"></p>
<p>200</p>
<p><img src="/../images/1746794880605.png" srcset="/img/loading.gif" lazyload alt="1746794880605"></p>
<p><img src="/../images/1746795922010.png" srcset="/img/loading.gif" lazyload alt="1746795922010"></p>
<p>80 后面5个0</p>
<p>90 后面4个0</p>
<p>100 后面3个0</p>
<p>误差越来越大</p>
<p>z2完了后，交换halo区的数据到有效区就不要再交换回来了吧，删掉。</p>
<p>目录26</p>
<p>什么时候交换到halo区，flux的值改变的时候。 z1 z3</p>
<p>什么时候从halo区交换到有效区，flux k+1 的值改变的时候。z2</p>
<p>z2不要等整体算完之后再传，要算完一块，然后将这一块的halo区传入下一块的有效区，然后再计算下一块。</p>
<p>还是不行。</p>
<p>目录24，x3y3拆成两个，并且每个后面都加flux通信反而误差更大，25步</p>
<p><img src="/../images/1746766535742.png" srcset="/img/loading.gif" lazyload alt="1746766535742"></p>
<p>2025年5月10日10:13:13</p>
<p>合并z3z4 目录27 一样的误差</p>
<p>60 后面7个0</p>
<p>60 - 70</p>
<p><img src="/../images/1746797407275.png" srcset="/img/loading.gif" lazyload alt="1746797407275"></p>
<p>70 后面6个0</p>
<p>跑两轮看看是不是两次的结果一致<br>如果结果一致，说明误差是产生的而不是由于浮点运算导致的<br>每一个代码两次结果都没有误差，误差为0，说明两次结果的误差一致，误差是真实存在的，不是浮点运算导致的误差。</p>
<p>100步的误差</p>
<p><img src="/../images/1746845029665.png" srcset="/img/loading.gif" lazyload alt="1746845029665"></p>
<p>找到具体哪个值，然后输出Lcon </p>
<p>pre(2,22,26,66)<code>pre[65][25][21][1]</code></p>
<p>输出一百步的Lcon对比<br>好好想想，什么被忽略了，动动脑袋</p>
<p><code>Lcon[65][25][21][1]</code></p>
<p><img src="/../images/1746862452933.png" srcset="/img/loading.gif" lazyload alt="1746862452933"></p>
<p>发现规律了 误差大的k都是44 ，65 这种，属于卡的边界的值。说明边界处理还是有问题，不是浮点误差导致的。</p>
<p>所以肯定是Lcon的计算有错误。</p>
<p>但到底是flux_US错误还是flux 错误呢。</p>
<p><img src="/../images/1746868223629.png" srcset="/img/loading.gif" lazyload alt="1746868223629"></p>
<p>z1后不用halo,因为后面z2只是对下一个卡的有效区进行修改，没有使用halo的数据，</p>
<p>然后z2完毕后flux更新了，但是不用halo，因为z3中没有用到halo区</p>
<p>z3执行完后flux更新了，这时候要halo了，因为z4用到了halo区的值</p>
<p>测试：</p>
<p>25 步有误差</p>
<p><img src="/../images/1746927732794.png" srcset="/img/loading.gif" lazyload alt="1746927732794"></p>
<p>如果还是不行，z3后还交不交换</p>
<p>2025年5月11日09:41:56</p>
<p>我觉得还是lcon的计算有误<br>输出lcon<br>在27的基础上，把三四放一起再测测</p>
<p>加油加油⛽</p>
<p>三四放一起</p>
<p>test：误差更大</p>
<p>在三四放一起这个基础上，直接操作下一个卡中的flux试试，并且改了范围-2Halo 不对，应该是 - HALO - 1 </p>
<p>test：误差和目录25一样，说明不是这的问题，这里本来就是对的</p>
<p>如果不行就再拆分34， 三之后通信</p>
<p>结果和上面的一样，不论是拆开还是直接对下一张卡通信，误差都存在，说明问题不在这。</p>
<p>在源程序的基础上，把三四分开试试结果还对不对，这里也不用试了。</p>
<p>输出Lcon</p>
<p><img src="/../images/1746928022943.png" srcset="/img/loading.gif" lazyload alt="1746928022943"></p>
<p>39</p>
<p><img src="/../images/1746929142469.png" srcset="/img/loading.gif" lazyload alt="1746929142469"></p>
<p><img src="/../images/1746929149670.png" srcset="/img/loading.gif" lazyload alt="1746929149670"></p>
<p>从这里的m &#x3D; 3， Lcon 开始有误差了。</p>
<p>输出flux </p>
<p><img src="/../images/1746942667670.png" srcset="/img/loading.gif" lazyload alt="1746942667670"></p>
<p><img src="/../images/1746942675414.png" srcset="/img/loading.gif" lazyload alt="1746942675414"></p>
<p>39 rk  &#x3D;1 ;</p>
<p><img src="/../images/1746943027366.png" srcset="/img/loading.gif" lazyload alt="1746943027366"></p>
<p><img src="/../images/1746943037522.png" srcset="/img/loading.gif" lazyload alt="1746943037522"></p>
<p>38 rk  &#x3D; 2  从这里开始有错误</p>
<p><img src="/../images/1746943086360.png" srcset="/img/loading.gif" lazyload alt="1746943086360"></p>
<p><img src="/../images/1746943096460.png" srcset="/img/loading.gif" lazyload alt="1746943096460"></p>
<p>在这里前面输出</p>
<p>38 rk &#x3D;1 到 rk &#x3D; 2 中间经历了什么 Lcon的值被改变了<br>输出的位置是fluid &#x3D; 2 ， 执行完z后<br>rk &#x3D; 1 fluid &#x3D;2 执行完z后没问题，然后执行<br>rk &#x3D; 2 fluid &#x3D; 1 fx fy fz （没问题） ,fluid &#x3D; 2 fx （fx后）  fy （fz前有问题）fz</p>
<p>38 fz计算前</p>
<p><img src="/../images/1746944298171.png" srcset="/img/loading.gif" lazyload alt="1746944298171"></p>
<p><img src="/../images/1746944302874.png" srcset="/img/loading.gif" lazyload alt="1746944302874"></p>
<p>计算前就有问题了，再输出</p>
<p>fluid &#x3D; 1 fz后输出 38 没问题</p>
<p><img src="/../images/1746944666072.png" srcset="/img/loading.gif" lazyload alt="1746944666072"></p>
<p><img src="/../images/1746944678847.png" srcset="/img/loading.gif" lazyload alt="1746944678847"></p>
<p>fluid &#x3D; 2 fx 后</p>
<p><img src="/../images/1746946067406.png" srcset="/img/loading.gif" lazyload alt="1746946067406"></p>
<p><img src="/../images/1746946089252.png" srcset="/img/loading.gif" lazyload alt="1746946089252"></p>
<p><img src="/../images/1746946119937.png" srcset="/img/loading.gif" lazyload alt="1746946119937">的值不对 ,前一步还对，说明这里被算错了 <img src="/../images/1746946178377.png" srcset="/img/loading.gif" lazyload alt="1746946178377">的值没问题</p>
<p>在fx计算前再输出看看</p>
<p><img src="/../images/1746946414186.png" srcset="/img/loading.gif" lazyload alt="1746946414186"></p>
<p><img src="/../images/1746946471544.png" srcset="/img/loading.gif" lazyload alt="1746946471544"></p>
<p>计算前<img src="/../images/1746946553142.png" srcset="/img/loading.gif" lazyload alt="1746946553142">也不对,fx3计算前不对，fx2 呢 ？</p>
<p>fx2计算前</p>
<p><img src="/../images/1746947011955.png" srcset="/img/loading.gif" lazyload alt="1746947011955"></p>
<p><img src="/../images/1746947035974.png" srcset="/img/loading.gif" lazyload alt="1746947035974"></p>
<p>计算前也不对</p>
<p>fx1 计算前呢 没问题</p>
<p><img src="/../images/1746947355330.png" srcset="/img/loading.gif" lazyload alt="1746947355330"></p>
<p><img src="/../images/1746947468632.png" srcset="/img/loading.gif" lazyload alt="1746947468632"></p>
<p>fx1 计算后  有问题</p>
<p><img src="/../images/1746947865158.png" srcset="/img/loading.gif" lazyload alt="1746947865158"></p>
<p><img src="/../images/1746947892112.png" srcset="/img/loading.gif" lazyload alt="1746947892112"></p>
<p>说明 fx1的计算出了问题。</p>
<p><img src="/../images/1746951312167.png" srcset="/img/loading.gif" lazyload alt="1746951312167"></p>
<p><img src="/../images/1746951330197.png" srcset="/img/loading.gif" lazyload alt="1746951330197"></p>
<p>wL算错了，是由prim_w赋值的，输出prim_w</p>
<p><img src="/../images/1746952050089.png" srcset="/img/loading.gif" lazyload alt="1746952050089"></p>
<p><img src="/../images/1746952075004.png" srcset="/img/loading.gif" lazyload alt="1746952075004"></p>
<p>prim_w[0]算错了，其他没问题。tg &#x3D; 1 的时候</p>
<p><img src="/../images/1746952698717.png" srcset="/img/loading.gif" lazyload alt="1746952698717"></p>
<p>prim_w[0] &#x3D; <code>vel_w[k][j][icR - 2][1]</code></p>
<p><img src="/../images/1746953372420.png" srcset="/img/loading.gif" lazyload alt="1746953372420"></p>
<p><img src="/../images/1746953666675.png" srcset="/img/loading.gif" lazyload alt="1746953666675"></p>
<p>说明vel_w传错了 cpu &gt; 4个dcu 传入有问题</p>
<p>就从这一步开始传入有错误了</p>
<p>从头输出，看看是不是这一步传入有错误，从头输出和这个结果一致。</p>
<p>然后在末尾输出，也一致，说明在38.2 传入的时候就出错了</p>
<p>计算错误在38.1的结束</p>
<p><img src="/../images/1746955165756.png" srcset="/img/loading.gif" lazyload alt="1746955165756"></p>
<p><img src="/../images/1746955175348.png" srcset="/img/loading.gif" lazyload alt="1746955175348"></p>
<p>是赋值后后错误了，还是con ,con2 本来就错误了</p>
<p>输出con ，con2</p>
<p>37.2 没问题</p>
<p>38.1</p>
<p><img src="/../images/1746956075324.png" srcset="/img/loading.gif" lazyload alt="1746956075324"></p>
<p><img src="/../images/1746956081375.png" srcset="/img/loading.gif" lazyload alt="1746956081375"></p>
<p><img src="/../images/1746955863217.png" srcset="/img/loading.gif" lazyload alt="1746955863217"></p>
<p>出错</p>
<p><img src="/../images/1746955899233.png" srcset="/img/loading.gif" lazyload alt="1746955899233"></p>
<p>对上了，就是con2 的这个下标改变了vel_w的值</p>
<p>这个值算错了，而不是vel_w传输的问题。再往前找。问题出在<strong>38.1的计算过程中</strong>，因为38.2的输出无误</p>
<p>输出这个imark<img src="/../images/1746956453580.png" srcset="/img/loading.gif" lazyload alt="1746956453580"></p>
<p><img src="/../images/1746957428963.png" srcset="/img/loading.gif" lazyload alt="1746957428963"></p>
<p><img src="/../images/1746957444612.png" srcset="/img/loading.gif" lazyload alt="1746957444612"></p>
<p>con2错误，是由于Lcon错误</p>
<p>输出flux，这不是循环了吗，是或不是，测试一下<img src="/../images/1746958359503.png" srcset="/img/loading.gif" lazyload alt="1746958359503"></p>
<p><img src="/../images/1746958238107.png" srcset="/img/loading.gif" lazyload alt="1746958238107"></p>
<p><img src="/../images/1746958289225.png" srcset="/img/loading.gif" lazyload alt="1746958289225"></p>
<p>这里Lcon也错了，导致con2错误。 </p>
<p>往前推</p>
<p><code>Lcon[65][25][17][3] istep 37，Rk = 2</code></p>
<p> 所以Lcon可能在一开始就错了</p>
<p>输出第几步的Lcon !!!</p>
<p>之前的输出发现</p>
<p><img src="/../images/1746964911135.png" srcset="/img/loading.gif" lazyload alt="1746964911135"></p>
<p>43正好是边界</p>
<p>输出Lcon吧，作对比</p>
<p>找到了又怎么改呢，是flux错误还是Lcon错误</p>
<p>1.1 fluid &#x3D; 1结束Lcon同,1.2fluid &#x3D; 1结束 不同</p>
<p>中间还有一个1.1   fluid &#x3D; 2 输出不同</p>
<p>先找到在哪个位置，然后再输出flux 的值，看看哪个代码文件里面发生的错误。</p>
<p>是不是又是循环了</p>
<p>istep &#x3D; 1 ,rk &#x3D;1 fluid &#x3D;2      Lcon同fx1  -  fx3不同</p>
<p>就是在x3里面被改了。</p>
<p>x2后的flux 没问题</p>
<p>x1后的flux 没问题</p>
<p><strong>说明什么 flux 在z3中被改了，然后导致Lcon不正确</strong></p>
<p>2025年5月11日22:12:56 end</p>
<p>38 rk &#x3D; 1 没问题</p>
<p><img src="/../images/1746943160704.png" srcset="/img/loading.gif" lazyload alt="1746943160704"></p>
<p><img src="/../images/1746943145231.png" srcset="/img/loading.gif" lazyload alt="1746943145231"></p>
<p>37</p>
<p><img src="/../images/1746943655959.png" srcset="/img/loading.gif" lazyload alt="1746943655959"></p>
<p><img src="/../images/1746943668121.png" srcset="/img/loading.gif" lazyload alt="1746943668121"></p>
<p>40</p>
<p><img src="/../images/1746929159896.png" srcset="/img/loading.gif" lazyload alt="1746929159896"></p>
<p><img src="/../images/1746929172747.png" srcset="/img/loading.gif" lazyload alt="1746929172747"></p>
<p><img src="/../images/1746929185793.png" srcset="/img/loading.gif" lazyload alt="1746929185793"></p>
<p>2025年5月12日10:18:03</p>
<p>之前测的有问题Lcon没传回就输出了，再测</p>
<p>istep &#x3D; 1 ,rk &#x3D;1</p>
<p><strong>fluid &#x3D; 2</strong></p>
<p>x2后的flux 没问题</p>
<p>x1后的flux 没问题</p>
<p>z3后flux 没问题</p>
<p>x3后输出Lcon 同</p>
<p>z3后呢？Lcon也没问题</p>
<p>RK &#x3D; 2</p>
<p>fluid &#x3D; 2 </p>
<p>z3后输出Lcon</p>
<p>也没问题</p>
<p>istep &#x3D; 2 ,RK &#x3D;2，fluid &#x3D;2 </p>
<p>z3 后输出</p>
<p>还没问题</p>
<p>istep &#x3D; 3 没问题</p>
<p>31 有问题，25没问题，28有问题</p>
<p>26错了 26,RK &#x3D; 1 错了</p>
<p>fluid &#x3D;1 中呢 错了</p>
<p><img src="/../images/1747027035668.png" srcset="/img/loading.gif" lazyload alt="1747027035668"></p>
<p>26,RK &#x3D; 1 fluid  &#x3D;1 ；</p>
<p>z之前 同样的输出</p>
<p>x之前 同样的输出，这里就错了。</p>
<p>但是25 Rk &#x3D;2 fluid &#x3D; 2 完毕后不是没错误吗。又测了一遍没错误。</p>
<p>26,RK &#x3D; 1 fluid  &#x3D;1 ； x之前输出就有错误是为什么</p>
<p><img src="/../images/1747028856462.png" srcset="/img/loading.gif" lazyload alt="1747028856462"></p>
<p>都是这个值</p>
<p>左边的值被赋值为0 了，但是右边的值没有被赋值为0 </p>
<p>还是不变所以出错了。找到被赋值为0 的地方。</p>
<p>加上每一次都给那三个数组赋值为0</p>
<p>再测 26,RK &#x3D; 1 fluid  &#x3D;1 ； x之前输出</p>
<p>原来有的不为0 是因为什么？</p>
<p>试试对了吗，都为0 了</p>
<p>不对</p>
<p>再输出</p>
<p>再测 26,RK &#x3D; 1 fluid  &#x3D;1 ； z后输出</p>
<p><img src="/../images/1747033414288.png" srcset="/img/loading.gif" lazyload alt="1747033414288"></p>
<p>x前输出看看是不是都是0</p>
<p><img src="/../images/1747035654504.png" srcset="/img/loading.gif" lazyload alt="1747035654504"></p>
<p>为什么有值呢？</p>
<p>fortran代码输出</p>
<p><img src="/../images/1747038300915.png" srcset="/img/loading.gif" lazyload alt="1747038300915"></p>
<p>在19里面把三个数组改为double，然后赋值不为0，当时为什么为0 ，呢，然后在传给dcu，<br>之后225步误差为0，一点误差都没有了</p>
<p>同样在目录25里面也改了，先给cpu数组赋值，然后传给gpu，将之前allocate函数里面的memset删掉，<br>只给这三个数组分配显存，赋值在equation里面通过cpu传入每个dcu卡中的有效区域。</p>
<p>测试还是同样的误差，说明不是这的问题。</p>
<p>再测 26,RK &#x3D; 1 fluid  &#x3D;1 ； z后输出 Lcon没错误了</p>
<p>RK&#x3D; 2 fluid  &#x3D;1 ； z后输出  Lcon也没错误</p>
<p>同样的位置，100 RK  &#x3D;2 Lcon也没错，但是</p>
<p><img src="/../images/1747045273563.png" srcset="/img/loading.gif" lazyload alt="1747045273563"></p>
<p>Lcon没错说明什么？说明上一步的con没错。</p>
<p>200步 </p>
<p>还是circle有问题</p>
<p>225还是circle</p>
<p>fluid  &#x3D;2 ； z后输出 </p>
<p>225 </p>
<p><img src="/../images/1747049645135.png" srcset="/img/loading.gif" lazyload alt="1747049645135"></p>
<p>这里有问题了，说明问题出在fluid &#x3D; 2 里面，fluid &#x3D; 1 的计算是对的。</p>
<p>找找具体在哪一步的fluid &#x3D;2 里面</p>
<p>77 步 </p>
<p><img src="/../images/1747050240024.png" srcset="/img/loading.gif" lazyload alt="1747050240024"></p>
<p>25步 只是</p>
<p><img src="/../images/1747050637917.png" srcset="/img/loading.gif" lazyload alt="1747050637917"></p>
<p>60步错了</p>
<p><img src="/../images/1747050968233.png" srcset="/img/loading.gif" lazyload alt="1747050968233"></p>
<p>30错</p>
<p><img src="/../images/1747051206382.png" srcset="/img/loading.gif" lazyload alt="1747051206382"></p>
<p>26</p>
<p><img src="/../images/1747051442365.png" srcset="/img/loading.gif" lazyload alt="1747051442365"></p>
<p>错了</p>
<p>说明，问题出在 itsep &#x3D; 26 RK &#x3D; 2 fluid &#x3D; 2 的计算里面，fluid &#x3D; 1 计算无误</p>
<p>在x后输出</p>
<p><img src="/../images/1747051890132.png" srcset="/img/loading.gif" lazyload alt="1747051890132"></p>
<p>x前输出没事</p>
<p>x2后输出 没问题</p>
<p>所以问题就是出在x3里面</p>
<p>在x2后输出flux</p>
<p><img src="/../images/1747053400880.png" srcset="/img/loading.gif" lazyload alt="1747053400880"></p>
<p>x1后输出flux</p>
<p><img src="/../images/1747053637603.png" srcset="/img/loading.gif" lazyload alt="1747053637603"></p>
<p>x1就错了</p>
<p>在x1前输出flux 同</p>
<p>所以flux的值在x1中算错了</p>
<p><img src="/../images/1747055495698.png" srcset="/img/loading.gif" lazyload alt="1747055495698"></p>
<p><img src="/../images/1747055478183.png" srcset="/img/loading.gif" lazyload alt="1747055478183"></p>
<p>说明RK &#x3D; 1 的con算错了，但是RK &#x3D;1 的Lcon没有错误吗？</p>
<p>说明什么</p>
<p>输出26 RK &#x3D;1  后的con 和con 2 </p>
<p><img src="/../images/1747056341517.png" srcset="/img/loading.gif" lazyload alt="1747056341517"></p>
<p>说明 26 RK &#x3D;1  的con算错了</p>
<p>输入完有问题吗 没问题</p>
<p>说明就是26 RK &#x3D;1 的Lcon算错了</p>
<p>输出这里的Lcon fluid &#x3D; 2 </p>
<p><img src="/../images/1747058459100.png" srcset="/img/loading.gif" lazyload alt="1747058459100"></p>
<p>这里的Lcon算错了</p>
<p>z2后</p>
<p><img src="/../images/1747058995292.png" srcset="/img/loading.gif" lazyload alt="1747058995292"></p>
<p>z1后 </p>
<p><img src="/../images/1747059227213.png" srcset="/img/loading.gif" lazyload alt="1747059227213"></p>
<p>z1前 没错误</p>
<p>错误在z1中</p>
<p>z1的错误可能是25 RK &#x3D;2 con 计算错误导致的，输出con 没问题</p>
<p>所以 <strong>错误在z1中</strong></p>
<p>2025年5月16日13:13:39</p>
<p>在z1中输出</p>
<p><img src="/../images/1747376110209.png" srcset="/img/loading.gif" lazyload alt="1747376110209"></p>
<p>这种情况是数据传输的问题，还是con本来就没算对</p>
<p>vel_w对吗，可能是all_con_prim的计算有误</p>
<p>2025年5月17日09:20:17</p>
<p>16 rk&#x3D;2 fluid &#x3D; 2 ,vel_w有误，这个是上一步计算完的con赋值的。</p>
<p>输出16 rk &#x3D;  2 刚传进来的主机con有误没，无误，den&gt;con 赋值后的con有误没有，</p>
<p><code>  d_con（传回的con无误） &gt; d_vel_w &gt; vel_w这里呢&gt; d_vel_w有误</code> </p>
<p><code>d_vel_w &gt; d_con 无误</code>,d_vel_w无误，但是Halo区的数据有问题，说明halo通信Error</p>
<p>再输出一下vel_w也无误但是前面取vel_w halo区数据的时候取到了0，<strong>说明halo 错误</strong></p>
<p>memcpy的时候不同卡Local_k 不同，halo通信的时候两个卡用了同一个local_k这里有问题。</p>
<p>卡3 从卡2 获取边界数据到halo区</p>
<p><img src="/../images/1747466127878.png" srcset="/img/loading.gif" lazyload alt="1747466127878"></p>
<p>改完后225步没有误差了！！！2025年5月17日15:15:44</p>
<p>2025年5月18日11:34:09</p>
<p>内存越界，每一步都申请重复的变量，内存占用越界了。减少冗余变量，优化代码。</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E9%A1%B9%E7%9B%AE/" class="category-chain-item">项目</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E9%A1%B9%E7%9B%AE/" class="print-no-link">#项目</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>单卡到多卡success!!!</div>
      <div>http://example.com/2025/05/17/suc/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>hzbing</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年5月17日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/04/04/project23/" title="单卡到多卡1">
                        <span class="hidden-mobile">单卡到多卡1</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
